<html>
      <head>
            <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
            integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
            crossorigin=""/>
            <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
            integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
            crossorigin=""></script>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

            <style>            
                  #mapid { height: 100%; width:100%}
            </style>            
      </head>
      <body>
                  <div id="mapid"></div>
      </body>
      <script>

      var objects = [];

      var lastMarker = null;

      var totalDistance = 0;


      // create the slippy map
      var map = L.map('mapid', {
            minZoom: -1,
            maxZoom: 5,
            center: [0, 0],
            zoom: 1,
            crs: L.CRS.Simple
      });

      $(document).keyup(function(e) {
            if (e.key === "Escape") { 
                  objects.forEach(object => {
                        map.removeLayer(object);                        
                  });

                  lastMarker = null;

                  totalDistance = 0;
            }
      });
      
      // dimensions of the image
     /* var w = 11560,
      h = 7480,
      url = './map.jpg';*/
      
      // 70 points == 500 miles
      // 1 point == 7.5 mile 
      // 1 point == 12 kilometers
      var w = 5780,
      h = 3740,
      url = '/images/creation.jpg';
      

      // calculate the edges of the image, in coordinate space
     /* var southWest = map.unproject([0, h], map.getMaxZoom()-1);
      var northEast = map.unproject([w, 0], map.getMaxZoom()-1);
      var bounds = new L.LatLngBounds(southWest, northEast);*/

      var bounds = [[0,0],[1500,2325]]

      // add the image overlay, 
      // so that it covers the entire map
      L.imageOverlay(url, bounds).addTo(map);

      // tell leaflet that the map is exactly as big as the image
      //map.setMaxBounds(bounds);
      map.fitBounds(bounds);

      var speeds = {
				'Horse':[4,10],
				'Merchant Ship':[6,24],
				'Cirrus Skiff (Ess 1)':[6,24],
				'Agata':[30,10],
				'Stormwind Rider':[100,10]
                  }

      var popup = L.popup();

      function onMapClick(e) {


            var tmpMarker = null;

            if(lastMarker != null)
            {
                  tmpMarker = lastMarker;
            }
            // add marker
            lastMarker = L.marker(e.latlng);
            
            lastMarker.addTo(map).bindPopup('Sol');

            objects.push(lastMarker);

            if(tmpMarker != null)
            {
                  line = L.polyline([lastMarker.getLatLng(), tmpMarker.getLatLng()]);

                  objects.push(line);

                  line.addTo(map);

                  distance = map.distance(lastMarker.getLatLng(), tmpMarker.getLatLng());

                  totalDistance = totalDistance + distance;

                  miles = (totalDistance * 7.5)

                  var text = Math.floor(miles) + " Miles<br>" + Math.floor(miles * 1.609) + " Kilometers";

                  for (var k in speeds) 
                  {
                                    var days = Math.floor((miles / (speeds[k][0] * speeds[k][1])) * 10) / 10;
                                    var hours = Math.floor((days - Math.floor(days)) * speeds[k][1])
                                    if (days >= 1) var dur = Math.floor(days) + ' day' + (Math.floor(days) == 1 ? '' : 's');
                                    else var dur = hours + ' hour' + (hours == 1 ? '' : 's');
                                    text += "<br>" + k + ": " + dur;
                  }

                  popup.setLatLng(e.latlng).setContent(text).openOn(map);
            }
      
      }

      map.on('click', onMapClick);

      </script>
</html>